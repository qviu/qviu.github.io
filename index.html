<!DOCTYPE html>
<html>
<head>
    <title>Pencarian Harga Barang</title>
    <style>
        /* CSS untuk menyembunyikan field pencarian dan tombol cetak serta kalimat pencarian saat mencetak */
        @media print {
            #keyword, h5, input[type="submit"], button, .card {
                display: none;
            }
            table {
                display: table;
                width: 100%;
            }
        }
        .card-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .card {
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 15px;
            width: calc(33% - 20px);
            box-sizing: border-box;
        }
        .card h3, .card p {
            margin: 10px 0;
        }
        table {
            display: none;
            border-collapse: collapse;
            width: 100%;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
    </style>
</head>
<body>
    <h2>Pencarian Harga Barang</h2>
    <form id="searchForm">
        <h5><label for="keyword">Cari berdasarkan kode barang atau nama barang (pisahkan dengan koma untuk pencarian lebih dari satu barang):</label></h5><br>
        <input type="text" id="keyword" name="keyword"><br>
        <input type="submit" value="Cari">
    </form>
    <br>
    <button onclick="printPage()">Cetak</button>
    <div id="results"></div>
    <script>
        document.getElementById('searchForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const keyword = document.getElementById('keyword').value;
            if (keyword) {
                cariHargaBarang(keyword.split(','));
            }
        });

        function printPage() {
            window.print();
        }

        async function getDataBarang() {
            const folderPath = 'data/';
            const fileNames = ['daihatsu.json', 'suzuki.json']; // Ganti dengan daftar nama file JSON Anda
            let dataBarang = [];

            for (const fileName of fileNames) {
                const response = await fetch(folderPath + fileName);
                const data = await response.json();
                dataBarang = dataBarang.concat(data);
            }

            return dataBarang;
        }

        async function cariHargaBarang(keywords) {
            const dataBarang = await getDataBarang();
            const hasilPencarian = [];
            keywords = keywords.map(keyword => keyword.trim().replace(/[^a-zA-Z0-9]/g, '').toLowerCase());

            for (const keyword of keywords) {
                for (const barang of dataBarang) {
                    const kodeBarang = barang.kode.replace(/[^a-zA-Z0-9]/g, '').toLowerCase();
                    const namaBarang = barang.nama.replace(/[^a-zA-Z0-9]/g, '').toLowerCase();
                    if (kodeBarang.includes(keyword) || namaBarang.includes(keyword)) {
                        hasilPencarian.push(barang);
                    }
                }
            }

            tampilkanHasilPencarian(hasilPencarian);
        }

        function tampilkanHasilPencarian(hasilPencarian) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';

            if (hasilPencarian.length > 0) {
                const cardContainer = document.createElement('div');
                cardContainer.className = 'card-container';

                const table = document.createElement('table');
                const headerRow = document.createElement('tr');
                ['Kode Barang', 'Nama Barang', 'Merek Barang', 'Harga Barang', 'Berlaku'].forEach(text => {
                    const th = document.createElement('th');
                    th.textContent = text;
                    headerRow.appendChild(th);
                });
                table.appendChild(headerRow);

                hasilPencarian.forEach(barang => {
                    const card = document.createElement('div');
                    card.className = 'card';

                    const kodeBarang = document.createElement('h3');
                    kodeBarang.textContent = `Kode: ${barang.kode}`;
                    card.appendChild(kodeBarang);

                    const namaBarang = document.createElement('p');
                    namaBarang.textContent = `Nama: ${barang.nama}`;
                    card.appendChild(namaBarang);

                    const merekBarang = document.createElement('p');
                    merekBarang.textContent = `Merek: ${barang.merek}`;
                    card.appendChild(merekBarang);

                    const hargaBarang = document.createElement('p');
                    hargaBarang.textContent = `Harga: Rp${new Intl.NumberFormat('id-ID').format(barang.harga)}`;
                    card.appendChild(hargaBarang);

                    const berlaku = document.createElement('p');
                    berlaku.textContent = `Berlaku: ${barang.berlaku}`;
                    card.appendChild(berlaku);

                    cardContainer.appendChild(card);

                    const row = document.createElement('tr');
                    ['kode', 'nama', 'merek', 'harga', 'berlaku'].forEach(key => {
                        const td = document.createElement('td');
                        td.textContent = key === 'harga' ? new Intl.NumberFormat('id-ID').format(barang[key]) : barang[key];
                        row.appendChild(td);
                    });
                    table.appendChild(row);
                });

                resultsDiv.appendChild(cardContainer);
                resultsDiv.appendChild(table);
            } else {
                resultsDiv.textContent = 'Barang tidak ditemukan.';
            }
        }
    </script>
</body>
</html>
